<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Jeu Médiéval Fantastique</title>
<style>
body { font-family: Arial, sans-serif; background:#2e2b2b; color:#fff; text-align:center; }
#resources, #buildings, #units, #timers, #actions { margin: 20px auto; padding:10px; border:1px solid #555; border-radius:10px; width:80%; background:#3a3737; }
button { margin:5px; padding:10px; border:none; border-radius:5px; background:#5a4c4c; color:#fff; cursor:pointer; }
button:hover { background:#7a5c5c; }
.building, .unit, .timer { margin:5px 0; }
img { vertical-align:middle; width:24px; height:24px; margin-right:5px; }
</style>
</head>
<body>

<h1>Le Royaume Médiéval Fantastique</h1>

<div id="resources">
  <div id="gold">Or : 0</div>
  <div id="wood">Bois : 0</div>
  <div id="food">Nourriture : 0</div>
</div>

<div id="buildings"><h3>Bâtiments</h3></div>
<div id="units"><h3>Unités</h3></div>
<div id="timers"><h3>Actions en cours</h3></div>
<div id="actions"><h3>Actions</h3></div>

<script>
let resources = { gold:100, wood:50, food:30 };
let buildings = [];
let units = [];
let timers = [];

// Bâtiments
const buildingTypes = [
  { name:'Maison de Pierre', cost:{gold:50, wood:20}, buildTime:10, production:{gold:0, wood:0, food:0} },
  { name:'Ferme Enchantée', cost:{gold:30, wood:20}, buildTime:8, production:{gold:0, wood:0, food:1} },
  { name:'Scierie Mystique', cost:{gold:40, wood:30}, buildTime:12, production:{gold:0, wood:0.5, food:0} },
  { name:'Mine de Mithril', cost:{gold:60, wood:40}, buildTime:15, production:{gold:1, wood:0, food:0} }
];

// Unités
const unitTypes = [
  { name:'Guerrier', cost:{gold:30, food:10}, trainTime:5, hp:20, attack:5 },
  { name:'Archer', cost:{gold:25, food:8}, trainTime:6, hp:15, attack:6 },
  { name:'Mage', cost:{gold:50, food:15}, trainTime:12, hp:10, attack:10 }
];

// Adversaire IA
let enemy = {
  name: "Orc sauvage",
  units: [
    {name:'Guerrier', count:3, hp:20, attack:5},
    {name:'Archer', count:2, hp:15, attack:6}
  ]
};

function updateResources() {
  resources.gold = Math.floor(resources.gold);
  resources.wood = Math.floor(resources.wood);
  resources.food = Math.floor(resources.food);
  document.getElementById('gold').innerHTML = `<img src="https://img.icons8.com/emoji/48/ffffff/money-bag-emoji.png"/> Or : ${resources.gold}`;
  document.getElementById('wood').innerHTML = `<img src="https://img.icons8.com/emoji/48/ffffff/deciduous-tree-emoji.png"/> Bois : ${resources.wood}`;
  document.getElementById('food').innerHTML = `<img src="https://img.icons8.com/emoji/48/ffffff/honey-pot-emoji.png"/> Nourriture : ${resources.food}`;
}

function renderBuildings() {
  const container = document.getElementById('buildings');
  container.innerHTML = '<h3>Bâtiments</h3>';
  buildings.forEach(b => {
    const div = document.createElement('div');
    div.className = 'building';
    div.innerHTML = `<img src="https://img.icons8.com/emoji/48/ffffff/castle-emoji.png"/> ${b.name} (lvl ${b.level})`;
    container.appendChild(div);
  });
}

function renderUnits() {
  const container = document.getElementById('units');
  container.innerHTML = '<h3>Unités</h3>';
  units.forEach(u => {
    const div = document.createElement('div');
    div.className = 'unit';
    div.innerHTML = `<img src="https://img.icons8.com/emoji/48/ffffff/swords-emoji.png"/> ${u.name} x${u.count}`;
    container.appendChild(div);
  });
}

function updateTimersDisplay() {
  const container = document.getElementById('timers');
  container.innerHTML = '<h3>Actions en cours</h3>';
  timers.forEach(t => {
    const div = document.createElement('div');
    div.className = 'timer';
    div.innerHTML = `${t.type} : ${t.name} - ${t.remaining}s`;
    container.appendChild(div);
  });
}

function canAfford(cost) {
  return resources.gold >= cost.gold && resources.wood >= (cost.wood || 0) && resources.food >= (cost.food || 0);
}

function spendResources(cost) {
  resources.gold -= cost.gold;
  if(cost.wood) resources.wood -= cost.wood;
  if(cost.food) resources.food -= cost.food;
}

function addActions() {
  const container = document.getElementById('actions');
  container.innerHTML = '<h3>Actions</h3>';
  buildingTypes.forEach(b => {
    const btn = document.createElement('button');
    btn.innerText = `Construire ${b.name} (${b.cost.gold} Or, ${b.cost.wood||0} Bois, ${b.buildTime}s)`;
    btn.onclick = () => {
      if(canAfford(b.cost)) {
        spendResources(b.cost);
        timers.push({type:'Bâtiment', name:b.name, remaining:b.buildTime, building:b});
      } else alert('Ressources insuffisantes!');
    };
    container.appendChild(btn);
  });
  unitTypes.forEach(u => {
    const btn = document.createElement('button');
    btn.innerText = `Former ${u.name} (${u.cost.gold} Or, ${u.cost.food||0} Nourriture, ${u.trainTime}s)`;
    btn.onclick = () => {
      if(canAfford(u.cost)) {
        spendResources(u.cost);
        timers.push({type:'Unité', name:u.name, remaining:u.trainTime, unit:u});
      } else alert('Ressources insuffisantes!');
    };
    container.appendChild(btn);
  });

  // Bouton attaque
  const attackBtn = document.createElement('button');
  attackBtn.innerText = `Attaquer l'ennemi (${enemy.name})`;
  attackBtn.onclick = () => {
    if(units.length===0) { alert("Vous n'avez pas d'unités pour attaquer!"); return; }
    resolveCombat();
  };
  container.appendChild(attackBtn);
}

function resolveCombat() {
  let playerUnits = units.map(u => ({...u, hp:unitTypes.find(t=>t.name===u.name).hp}));
  let enemyUnits = enemy.units.map(u => ({...u}));

  while(playerUnits.some(u=>u.count>0) && enemyUnits.some(u=>u.count>0)) {
    // Joueur attaque
    playerUnits.forEach(u=>{
      if(u.count>0){
        let target = enemyUnits.find(e=>e.count>0);
        if(target){
          target.hp -= unitTypes.find(t=>t.name===u.name).attack * u.count;
          if(target.hp <=0) target.count =0;
        }
      }
    });
    // Ennemi attaque
    enemyUnits.forEach(e=>{
      if(e.count>0){
        let target = playerUnits.find(u=>u.count>0);
        if(target){
          target.hp -= e.attack * e.count;
          if(target.hp <=0) target.count=0;
        }
      }
    });
  }

  if(playerUnits.some(u=>u.count>0)) {
    alert("Victoire! Vous gagnez 50 Or et 30 Bois!");
    resources.gold +=50;
    resources.wood +=30;
  } else {
    alert("Défaite! Vos unités ont été détruites!");
    units = [];
  }
  updateResources();
  renderUnits();
}

addActions();

// Timer global toutes les secondes
setInterval(() => {
  // Production des bâtiments
  buildings.forEach(b => {
    resources.gold += b.production.gold;
    resources.wood += b.production.wood;
    resources.food += b.production.food;
  });

  // Décrémenter timers
  for(let i=timers.length-1; i>=0; i--) {
    timers[i].remaining -= 1;
    if(timers[i].remaining <=0) {
      if(timers[i].type==='Bâtiment') {
        let exists = buildings.find(b => b.name===timers[i].name);
        if(exists) exists.level +=1;
        else buildings.push({...timers[i].building, level:1});
      }
      if(timers[i].type==='Unité') {
        let exists = units.find(u => u.name===timers[i].name);
        if(exists) exists.count +=1;
        else units.push({name:timers[i].unit.name, count:1});
      }
      timers.splice(i,1);
    }
  }

  updateResources();
  renderBuildings();
  renderUnits();
  updateTimersDisplay();
},1000);
</script>

</body>
</html>
